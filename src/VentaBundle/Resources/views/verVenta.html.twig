{% extends "VentaBundle:Layouts:body.html.twig" %}
{% block content %}
	<div class="panel">
      <div class="panel-heading">
        <div class="topbar_options"><!--
           --><div class="btn-group">
                  <button type="button" class="btn btn-md btn-biosur dropdown-toggle" data-toggle="dropdown"><i class="fa fa-cloud-download"> </i> Exportar
                  <span class="caret ml5"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li>
                    <a href="#">Excel</a>
                  </li>
                  <li>
                    <a href="#">PDF</a>
                  </li>
                  <li>
                    <a href="#">HTML</a>
                  </li>
              </ul>
            </div><!--
             --><div class="btn-group">
                    <button type="button" class="btn btn-md btn-biosur dropdown-toggle" data-toggle="dropdown"><i class="fa fa-share"> </i> Ir a
                    <span class="caret ml5"></span>
                  </button>
                <ul class="dropdown-menu" role="menu">
                  <li>
                      <a href="{{ url('venta_vista_listaventa') }}">Lista de arriendos</a>
                  </li>
                  <li>
                      <a href="{{ url('venta_vista_ventaservicio') }}">Nuevo arriendo</a>
                  </li>
                  <li class="divider"></li>
                  <li>
                      <a href="#">Ver cliente</a>
                  </li>
                  <li>
                      <a href="#">Agregar cliente</a>
                  </li>
                </ul>
              </div>
          </div>
      </div>
      <div class="panel-body p20" id="invoice-item">
        
        <div class="row mb30">
          <div class="col-md-8">
            <div class="pull-left">
              <h1 class="mt10">Arriendo de {{ datosCliente.nombre_cliente }}</h1>
              <h5 class="mn">Arriendo N° {{ datosCliente.id_venta }}</h5>
              <h5 class="mn"> Creado el {{ datosCliente.fecha_registro }} </h5>
              <h5 class="mn"> Estado de arriendo
                {% if datosCliente.fecha_termino == null %}
                <b class="text-success">Activo</b>
                {% else %}
                <b class="text-warning">Finalizado</b>
                {% endif %}
              </h5>
            </div>
          </div>
          <!-- <div class="col-md-4"> <img src="assets/img/logos/logo.png" class="img-responsive center-block mt10 mw200 hidden-xs" alt="AdminDesigns"> </div> -->
          <div class="col-md-4">
            <div class="pull-right text-right">
              <!-- <h2 class="invoice-logo-text lh10">AdminDesigns</h2> -->
              <h5> Registrado por:
                <b class="text-primary">{{ datosCliente.nombre_usuario }} {{ datosCliente.apellido_usuario }}</b>
              </h5>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <a href="{{ url('mantencion_vista_asignarbannos', {id: datosCliente.id_venta}) }}" class="link_widget">
              <div class="panel panel-tile bg-{{ datosCliente.asignarBanno }} light">
              <div class="panel-body pn pl20 p5">
                  <i class="fa fa-check-circle-o icon-bg"></i>
                <ul class="info_1">
                  {% if datosCliente.cbanos != 0 %}
                  <li>
                    <h2 class="mt15 lh15">
                      <b>{{ datosCliente.cbanos }}</b>
                    </h2>
                    <h5 class="text-muted">Baños</h5>
                  </li>
                  {% endif %}
                  {% if datosCliente.ccaseta != 0 %}
                  <li>
                    <h2 class="mt15 lh15">
                      <b>{{ datosCliente.ccaseta }}</b>
                    </h2>
                    <h5 class="text-muted">Casetas</h5>
                  </li>
                  {% endif %}
                  {% if datosCliente.cducha != 0 %}
                  <li>
                    <h2 class="mt15 lh15">
                      <b>{{ datosCliente.cducha }}</b>
                    </h2>
                    <h5 class="text-muted">Duchas</h5>
                  </li>
                  {% endif %}
                  {% if datosCliente.cexterno != 0 %}
                  <li>
                    <h2 class="mt15 lh15">
                      <b>{{ datosCliente.cexterno }}</b>
                    </h2>
                    <h5 class="text-muted">Externos</h5>
                  </li>
                  {% endif %}
                  {% if datosCliente.clavamano != 0 %}
                  <li>
                    <h2 class="mt15 lh15">
                      <b>{{ datosCliente.clavamano }}</b>
                    </h2>
                    <h5 class="text-muted">Lavamanos</h5>
                  </li>
                  {% endif %}
                </ul>
              </div>
            </div>
            </a>
          </div>
          <div class="{{ datosCliente.asignacion != 0 ? 'col-md-3':'col-md-6' }}">
            <a href="{{ url('mantencion_vista_agregarruta', {id: datosCliente.id_venta}) }}" class="link_widget">
              <div class="panel panel-tile bg-{{ datosCliente.asignarRuta }} light">
              <div class="panel-body pn pl20 p5">
                  <i class="fa fa-road icon-bg"></i>
                  <ul class="info_1">
                    <li>
                      <h2 class="mt15 lh15">
                        <b>{{ datosCliente.cantidadDias }}</b>
                      </h2>
                      <h5 class="text-muted">Ruta</h5>
                    </li>
                  </ul>
              </div>
            </div>
          </a>
          </div>
          {% if datosCliente.asignacion != 0 %}
          <div class="col-md-3">
            <a href="{{ url('mantencion_vista_asignarlavamanos', {id: datosCliente.id_venta}) }}" class="link_widget">
              <div class="panel panel-tile bg-info light">
              <div class="panel-body pn pl20 p5">
                  <i class="fa fa-pencil-square-o icon-bg"></i>
                  <ul class="info_1">
                    <li>
                      <h2 class="mt15 lh15">
                        <b>{{ datosCliente.clavamano }}</b>
                      </h2>
                      <h5 class="text-muted">Asignación</h5>
                    </li>
                  </ul>
              </div>
            </div>
          </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-heading">
        <span class="panel-icon">
          <i class="fa fa-map-marker"></i>
        </span>
        <span class="panel-title">Destinos</span>
      </div>
      <div class="panel-body p20" id="invoice-item">
        <div class="row">
          <div class="col-md-12">
            <div id="mapa" style="height: 300px;"></div>
          </div>
        </div>
        <br>
      
        {% for detalle in datosCliente.detalle %}
        <div class="row" id="invoice-info">
          <div class="col-md-12">
            <div class="panel panel-alt">
              <div class="panel-heading">
                <span class="panel-title">
                  <i class="fa fa-info"></i> {{ detalle.nombre_servicio }} - {{ detalle.direccion }}, {{ detalle.comuna }}, {{ detalle.provincia }}, {{ detalle.region }}
                </span>
              </div>
              <div class="panel-body">
              	<div class="row">
              		<div class="col-md-4">
              			<address>
	                      <strong>Cantidad</strong>
                        {% if detalle.cbano != 0 %}     <br>Baños: {{ detalle.cbano }}         {% endif %}
                        {% if detalle.ccaseta != 0 %}   <br>Casetas: {{ detalle.ccaseta }}     {% endif %}
                        {% if detalle.cducha != 0 %}    <br>Duchas: {{ detalle.cducha }}       {% endif %}
                        {% if detalle.cexterno != 0 %}  <br>Externos: {{ detalle.cexterno }}   {% endif %}
                        {% if detalle.clavamano != 0 %} <br>Lavamanos: {{ detalle.clavamano }} {% endif %}
	                      <br> <strong>total</strong> {{ detalle.cantidadReal }} Productos
	                    </address>
              		</div>
              		<div class="col-md-4">
              			<address>
	                      <strong>Mantención</strong>
                        {% for ruta in detalle.ruta %}
                          <br> {{ ruta.nombre_dia }}
                        {% endfor %}
	                    </address>
              		</div>
              		<div class="col-md-4">
              			<address>
	                      <strong>Otra información</strong>
                        <p>{{ detalle.comentario }}</p>
	                    </address>
              		</div>
              	</div>
              </div>
            </div>
          </div>
        </div>

        {% endfor %}
        
      </div>
    </div>
    <div class="panel">
      <div class="panel-heading">
        <span class="panel-icon">
          <i class="fa fa-info"></i>
        </span>
        <span class="panel-title">Otra información<sub>10</sub></span>
      </div>
      <div class="panel-body p20" id="invoice-item">
        <div class="row" id="invoice-table">
          <div class="col-md-8">
            <h3>Últimas Mantenciones</h3>
            <table class="table table-striped">
              <thead>
                <tr>
                  <!-- <th>#</th> -->
                  <th>Fecha</th>
                  <th>Descripción</th>
                  <th>Dirección</th>
                  <th>Cantidad de baños</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for key, val in listaMantencion %}
                  <tr>
                    <td>{{ key }}</td>
                    <td>{{ val.descripcion }}</td>
                    <td>{{ val.ciudad }}, {{ val.direccion }}</td>
                    <td><span class="label label-{{ val.cant_realizado >= val.cant_total ? 'system':'warning' }}">{{ val.cant_realizado }}{{ val.cant_total != 0 ? '/'~val.cant_total }}</span></td>
                    <td class="text-right">
                      <div class="btn-group">
                        <a href="#" data-idruta="{{ val.id_ruta }}" data-iddetalle="{{ val.id_detalle }}" data-fecha="{{ val.fecha }}" class="btn btn-sm btn-default btn-detalle-mantencion"><i class="fa fa-search"></i></a>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="col-md-4">
            <h3>Bitácora</h3>
            <table class="table table-striped table-bordered">
              <thead>
                <tr class="success">
                  <th>Fecha</th>
                  <th>Descripción</th>
                </tr>
              </thead>
              <tbody>
                {% if bitacora %}
                  {% for reg in bitacora %}
                    <tr>
                      <td class="valign-top">{{ reg.fecha }}</td>
                      <td>{{ reg.descripcion|raw }}</td>
                    </tr>
                  {% endfor %}
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="row" id="invoice-footer">
          <div class="col-md-12">
            <div class="pull-left mt20 fs15 text-primary"> Ver todo</div>
            <div class="clearfix"></div>
            <!-- <div class="invoice-buttons">
              <a href="javascript:window.print()" class="btn btn-default mr10">
                <i class="fa fa-print pr5"></i> Print Invoice</a>
              <button class="btn btn-primary btn-gradient" type="button">
                <i class="fa fa-floppy-o pr5"></i> Save Invoice</button>
            </div> -->
          </div>
        </div>

      </div>
    </div>

<!-- Modal -->
<div class="modal fade" id="detalleMantencion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Detalle Mantención</h4>
      </div>
      <div class="modal-body">
        <table class="table table-bordered mbn table_detalle_mantencion">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Chofer</th>
                <th>Producto</th>
                <th>Asignado</th>
                <th>Comentario</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
          <br>
          <div class="form-group">
		    <!-- <label for="textarea_comentario" class="control-label">Comentario</label>
		    <textarea class="form-control" name="textarea_comentario" id="textarea_comentario" rows="3"></textarea> -->
		  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="mapaDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Detalle Mantención</h4>
      </div>
      <div class="modal-body">
        <div id="nmapa" style="height: 300px;"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block footerScripts %}
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAk4HzcdPciUZejfLnYpXqVPXH9wfBEAj8&callback=initialize"></script>
  <script src="{{ absolute_url(asset('vendor/plugins/gmap/gmaps.js')) }}"></script>
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAk4HzcdPciUZejfLnYpXqVPXH9wfBEAj8"></script> -->
  <script src="{{ absolute_url(asset('assets/bundles/venta/verVenta.js')) }}"></script>

  <script>
    var zoom = 2;
    function initialize() {

        var locations = [
            {% for detalle in datosCliente.detalle %}
              {% if detalle.lat != '' and detalle.lon != '' %}
                ['<p><strong>Diercción:</strong> {{ detalle.direccion }}, {{ detalle.comuna }}</p><p><strong>Productos:</strong>'+
                '{% if detalle.cbano != 0 %} {{ detalle.cbano }} Baños, {% endif %}'+
                '{% if detalle.ccaseta != 0 %} {{ detalle.ccaseta }} Casetas, {% endif %}'+
                '{% if detalle.cducha != 0 %} {{ detalle.cducha }} Duchas, {% endif %}'+
                '{% if detalle.cexterno != 0 %} {{ detalle.cexterno }} Baños externos, {% endif %}'+
                '{% if detalle.clavamano != 0 %} {{ detalle.clavamano }} Lavamanos {% endif %}'+
                '</p>', {{ detalle.lat }}, {{ detalle.lon }}],
              {% endif %}
            {% endfor %}
        ];

        {% for detalle in datosCliente.detalle %}
          {% if detalle.lat != '' and detalle.lon != '' %}
            zoom = 11;
          {% endif %}
        {% endfor %}

        // imagen
        var image = {
          url: "{{ absolute_url(asset('assets/img/bano1.png')) }}",
          // This marker is 20 pixels wide by 32 pixels high.
          size: new google.maps.Size(26, 51),
          // The origin for this image is (0, 0).
          origin: new google.maps.Point(0, 0),
          // The anchor for this image is the base of the flagpole at (0, 32).
          anchor: new google.maps.Point(10, 40)
        };

        window.map = new google.maps.Map(document.getElementById('mapa'), {
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            scrollwheel: false,
        });

        var infowindow = new google.maps.InfoWindow();

        var bounds = new google.maps.LatLngBounds();

        for (i = 0; i < locations.length; i++) {
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                icon: image,
                map: map
            });

            bounds.extend(marker.position);

            google.maps.event.addListener(marker, 'click', (function (marker, i) {
                return function () {
                    infowindow.setContent(locations[i][0]);
                    infowindow.open(map, marker);
                }
            })(marker, i));
        }

        map.fitBounds(bounds);

        var listener = google.maps.event.addListener(map, "idle", function () {
            map.setZoom(zoom);
            google.maps.event.removeListener(listener);
        });

    
        // var ruta = [
        //   new google.maps.LatLng(13.6203, 101.09),
        //   new google.maps.LatLng(15.0203, 102.09),
        //   new google.maps.LatLng(14.6203, 101.29),
        // ]; 

        // var lineas = new google.maps.Polyline({        
        //   path: ruta,
        //   map: map, 
        //   strokeColor: 'red', 
        //   strokeWeight: 4,  
        //   strokeOpacity: 0.6, 
        //   clickable: false
        // });
    }

    $(function(){
      // initialize();
    })
  </script>
{% endblock %}